/*!
 * maptalks.isects v0.1.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(require("maptalks")):"function"==typeof define&&define.amd?define(["maptalks"],n):n(r.maptalks)}(this,function(r){"use strict";function n(r,n,t){var e=r*n,a=b*r,o=a-r,u=a-o,i=r-u,f=b*n,s=f-n,h=f-s,v=n-h,c=e-u*h,l=c-i*h,g=l-u*v,p=i*v-g;return t?(t[0]=p,t[1]=e,t):[p,e]}function t(r,n){var t=r+n,e=t-r,a=t-e,o=n-e,u=r-a,i=u+o;return i?[i,t]:[t]}function e(r,n){var e=0|r.length,a=0|n.length;if(1===e&&1===a)return t(r[0],n[0]);var o,u,i=e+a,f=new Array(i),s=0,h=0,v=0,c=Math.abs,l=r[h],g=c(l),p=n[v],y=c(p);g<y?(u=l,h+=1,h<e&&(l=r[h],g=c(l))):(u=p,v+=1,v<a&&(p=n[v],y=c(p))),h<e&&g<y||v>=a?(o=l,h+=1,h<e&&(l=r[h],g=c(l))):(o=p,v+=1,v<a&&(p=n[v],y=c(p)));for(var m,b,d,M,w,j=o+u,A=j-o,x=u-A,k=x,C=j;h<e&&v<a;)g<y?(o=l,h+=1,h<e&&(l=r[h],g=c(l))):(o=p,v+=1,v<a&&(p=n[v],y=c(p))),u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=C+j,b=m-C,d=m-b,M=j-b,w=C-d,k=w+M,C=m;for(;h<e;)o=l,u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=C+j,b=m-C,d=m-b,M=j-b,w=C-d,k=w+M,C=m,h+=1,h<e&&(l=r[h]);for(;v<a;)o=p,u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=C+j,b=m-C,d=m-b,M=j-b,w=C-d,k=w+M,C=m,v+=1,v<a&&(p=n[v]);return k&&(f[s++]=k),C&&(f[s++]=C),s||(f[s++]=0),f.length=s,f}function a(r,n,t){var e=r+n,a=e-r,o=e-a,u=n-a,i=r-o;return t?(t[0]=i+u,t[1]=e,t):[i+u,e]}function o(r,n){var t=r.length;if(1===t){var e=w(r[0],n);return e[0]?e:[e[1]]}var a=new Array(2*t),o=[.1,.1],u=[.1,.1],i=0;w(r[0],n,o),o[0]&&(a[i++]=o[0]);for(var f=1;f<t;++f){w(r[f],n,u);var s=o[1];j(s,u[0],o),o[0]&&(a[i++]=o[0]);var h=u[1],v=o[1],c=h+v,l=c-h,g=v-l;o[1]=c,g&&(a[i++]=g)}return o[1]&&(a[i++]=o[1]),0===i&&(a[i++]=0),a.length=i,a}function u(r){for(var n=r.length,t=r[r.length-1],e=n,a=n-2;a>=0;--a){var o=t,u=r[a];t=o+u;var i=t-o,f=u-i;f&&(r[--e]=t,t=f)}for(var s=0,a=e;a<n;++a){var o=r[a],u=t;t=o+u;var i=t-o,f=u-i;f&&(r[s++]=f)}return r[s++]=t,r.length=s,r}function i(r,n){return n={exports:{}},r(n,n.exports),n.exports}function f(r,n){var t=r+n,e=t-r,a=t-e,o=n-e,u=r-a,i=u+o;return i?[i,t]:[t]}function s(r,n){var t=0|r.length,e=0|n.length;if(1===t&&1===e)return f(r[0],-n[0]);var a,o,u=t+e,i=new Array(u),s=0,h=0,v=0,c=Math.abs,l=r[h],g=c(l),p=-n[v],y=c(p);g<y?(o=l,h+=1,h<t&&(l=r[h],g=c(l))):(o=p,v+=1,v<e&&(p=-n[v],y=c(p))),h<t&&g<y||v>=e?(a=l,h+=1,h<t&&(l=r[h],g=c(l))):(a=p,v+=1,v<e&&(p=-n[v],y=c(p)));for(var m,b,d,M,w,j=a+o,A=j-a,x=o-A,k=x,C=j;h<t&&v<e;)g<y?(a=l,h+=1,h<t&&(l=r[h],g=c(l))):(a=p,v+=1,v<e&&(p=-n[v],y=c(p))),o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=C+j,b=m-C,d=m-b,M=j-b,w=C-d,k=w+M,C=m;for(;h<t;)a=l,o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=C+j,b=m-C,d=m-b,M=j-b,w=C-d,k=w+M,C=m,h+=1,h<t&&(l=r[h]);for(;v<e;)a=p,o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=C+j,b=m-C,d=m-b,M=j-b,w=C-d,k=w+M,C=m,v+=1,v<e&&(p=-n[v]);return k&&(i[s++]=k),C&&(i[s++]=C),s||(i[s++]=0),i.length=s,i}function h(r,n,t,e){for(var a=0;a<2;++a){var o=r[a],u=n[a],i=Math.min(o,u),f=Math.max(o,u),s=t[a],h=e[a],v=Math.min(s,h),c=Math.max(s,h);if(c<i||f<v)return!1}return!0}function v(r,n,t,e){var a=O(r,t,e),o=O(n,t,e);if(a>0&&o>0||a<0&&o<0)return!1;var u=O(t,r,n),i=O(e,r,n);return!(u>0&&i>0||u<0&&i<0)&&(0!==a||0!==o||0!==u||0!==i||h(r,n,t,e))}function c(r,n,t,e){if(!z(r,n,t,e))return[[0],[0],[0]];var a=E([t[1]],[-e[1]]),o=E([-t[0]],[e[0]]),u=E(E(G(o,r[1]),G(o,-n[1])),E(G(a,r[0]),G(a,-n[0]))),i=E(q(-r[0],n[1]),q(r[1],n[0])),f=E(q(-t[0],e[1]),q(t[1],e[0])),s=E(E(G(f,r[0]),G(f,-n[0])),E(G(i,-t[0]),G(i,e[0]))),h=E(E(G(f,r[1]),G(f,-n[1])),E(G(i,-t[1]),G(i,e[1])));return[N(s),N(h),N(u)]}function l(r){var n=0,t=r.length;switch(t){case 1:n=r[0];break;case 2:n=r[0]+r[1];break;case 3:n=r[0]+r[1]+r[2];break;case 4:n=r[0]+r[1]+r[2]+r[3];break;default:for(var e=0;e<t;e++)n+=r[e]}return n}function g(r,n){return r[0]===n[0]&&r[1]===n[1]}function p(r,n){Array.isArray(r)?(n[0]=r[0],n[1]=r[1]):(n[0]=r.x,n[1]=r.y)}function y(r,n){for(var t={},e=r.length,a=[],o=0;o<e;o++){var u=r[o],i=r[(o+1)%e];p(u,L),p(i,Q);for(var f=0;f<e;f++)if(o!==f){var s=r[f],h=r[(f+1)%e];if(p(s,J),p(h,K),!(g(J,L)||g(J,Q)||g(K,L)||g(K,Q))){var v=D(L,Q,J,K),c=v[2];if(1!==c.length||c[0]){var l=H(v[2]);if(v[0]=H(v[0])/l,v[1]=H(v[1])/l,v.pop(),!(g(v,L)||g(v,Q)||g(v,J)||g(v,K))){var y=v+"",m=!t[y];m&&(t[y]=!0);var b=m;n&&(b=n(v,o,u,i,f,s,h,m)),b&&a.push(v)}}}}}return a}var m=n,b=+(Math.pow(2,27)+1),d=e,M=a,w=m,j=M,A=o,x=u,k=s,C=i(function(r){function n(r,n){for(var t=new Array(r.length-1),e=1;e<r.length;++e)for(var a=t[e-1]=new Array(r.length-1),o=0,u=0;o<r.length;++o)o!==n&&(a[u++]=r[e][o]);return t}function t(r){for(var n=new Array(r),t=0;t<r;++t){n[t]=new Array(r);for(var e=0;e<r;++e)n[t][e]=["m",e,"[",r-t-1,"]"].join("")}return n}function e(r){return 1&r?"-":""}function a(r){if(1===r.length)return r[0];if(2===r.length)return["sum(",r[0],",",r[1],")"].join("");var n=r.length>>1;return["sum(",a(r.slice(0,n)),",",a(r.slice(n)),")"].join("")}function o(r){if(2===r.length)return[["sum(prod(",r[0][0],",",r[1][1],"),prod(-",r[0][1],",",r[1][0],"))"].join("")];for(var t=[],u=0;u<r.length;++u)t.push(["scale(",a(o(n(r,u))),",",e(u),r[0][u],")"].join(""));return t}function u(r){for(var e=[],u=[],i=t(r),f=[],l=0;l<r;++l)0===(1&l)?e.push.apply(e,o(n(i,l))):u.push.apply(u,o(n(i,l))),f.push("m"+l);var g=a(e),p=a(u),y="orientation"+r+"Exact",m=["function ",y,"(",f.join(),"){var p=",g,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",y].join(""),b=new Function("sum","prod","scale","sub",m);return b(h,s,v,c)}function i(r){var n=w[r.length];return n||(n=w[r.length]=u(r.length)),n.apply(void 0,r)}function f(){for(;w.length<=l;)w.push(u(w.length));for(var n=[],t=["slow"],e=0;e<=l;++e)n.push("a"+e),t.push("o"+e);for(var a=["function getOrientation(",n.join(),"){switch(arguments.length){case 0:case 1:return 0;"],e=2;e<=l;++e)a.push("case ",e,":return o",e,"(",n.slice(0,e).join(),");");a.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(a.join(""));var o=Function.apply(void 0,t);r.exports=o.apply(void 0,[i].concat(w));for(var e=0;e<=l;++e)r.exports[e]=w[e]}var s=m,h=d,v=A,c=k,l=5,g=1.1102230246251565e-16,p=(3+16*g)*g,y=(7+56*g)*g,b=u(3),M=u(4),w=[function(){return 0},function(){return 0},function(r,n){return n[0]-r[0]},function(r,n,t){var e,a=(r[1]-t[1])*(n[0]-t[0]),o=(r[0]-t[0])*(n[1]-t[1]),u=a-o;if(a>0){if(o<=0)return u;e=a+o}else{if(!(a<0))return u;if(o>=0)return u;e=-(a+o)}var i=p*e;return u>=i||u<=-i?u:b(r,n,t)},function(r,n,t,e){var a=r[0]-e[0],o=n[0]-e[0],u=t[0]-e[0],i=r[1]-e[1],f=n[1]-e[1],s=t[1]-e[1],h=r[2]-e[2],v=n[2]-e[2],c=t[2]-e[2],l=o*s,g=u*f,p=u*i,m=a*s,b=a*f,d=o*i,w=h*(l-g)+v*(p-m)+c*(b-d),j=(Math.abs(l)+Math.abs(g))*Math.abs(h)+(Math.abs(p)+Math.abs(m))*Math.abs(v)+(Math.abs(b)+Math.abs(d))*Math.abs(c),A=y*j;return w>A||-w>A?w:M(r,n,t,e)}];f()}),F=v,O=C[3],P=c,q=m,E=d,G=A,N=x,z=F,B=l,D=P,H=B,I=y,J=[0,0],K=[0,0],L=[0,0],Q=[0,0];r.Polygon.prototype.isects=function(){for(var n,t,e=r.Coordinate.toNumberArrays(this.getCoordinates()),a=[],o=0,u=e.length;o<u;o++)t=e[o],t.length>0&&(t=t.slice(0,t.length-1)),n=I(t),n.length>0&&a.push([o,n]);return a},r.MultiPolygon.prototype.isects=function(){for(var r,n=this.getGeometries(),t=[],e=0,a=n.length;e<a;e++)r=n[e].isects(),r.length>0&&t.push([e,r]);return t}});