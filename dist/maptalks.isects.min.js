/*!
 * maptalks.isects v0.1.1
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@^0.16.0 
 */
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(require("maptalks")):"function"==typeof define&&define.amd?define(["maptalks"],n):n(r.maptalks)}(this,function(r){"use strict";function n(r,n,t){var e=r*n,a=d*r,o=a-r,u=a-o,i=r-u,f=d*n,s=f-n,h=f-s,c=n-h,l=e-u*h,v=l-i*h,p=v-u*c,g=i*c-p;return t?(t[0]=g,t[1]=e,t):[g,e]}function t(r,n){var t=r+n,e=t-r,a=t-e,o=n-e,u=r-a,i=u+o;return i?[i,t]:[t]}function e(r,n){var e=0|r.length,a=0|n.length;if(1===e&&1===a)return t(r[0],n[0]);var o,u,i=e+a,f=new Array(i),s=0,h=0,c=0,l=Math.abs,v=r[h],p=l(v),g=n[c],y=l(g);p<y?(u=v,h+=1,h<e&&(v=r[h],p=l(v))):(u=g,c+=1,c<a&&(g=n[c],y=l(g))),h<e&&p<y||c>=a?(o=v,h+=1,h<e&&(v=r[h],p=l(v))):(o=g,c+=1,c<a&&(g=n[c],y=l(g)));for(var m,d,b,M,w,j=o+u,A=j-o,x=u-A,k=x,q=j;h<e&&c<a;)p<y?(o=v,h+=1,h<e&&(v=r[h],p=l(v))):(o=g,c+=1,c<a&&(g=n[c],y=l(g))),u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=q+j,d=m-q,b=m-d,M=j-d,w=q-b,k=w+M,q=m;for(;h<e;)o=v,u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=q+j,d=m-q,b=m-d,M=j-d,w=q-b,k=w+M,q=m,h+=1,h<e&&(v=r[h]);for(;c<a;)o=g,u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=q+j,d=m-q,b=m-d,M=j-d,w=q-b,k=w+M,q=m,c+=1,c<a&&(g=n[c]);return k&&(f[s++]=k),q&&(f[s++]=q),s||(f[s++]=0),f.length=s,f}function a(r,n,t){var e=r+n,a=e-r,o=e-a,u=n-a,i=r-o;return t?(t[0]=i+u,t[1]=e,t):[i+u,e]}function o(r,n){var t=r.length;if(1===t){var e=w(r[0],n);return e[0]?e:[e[1]]}var a=new Array(2*t),o=[.1,.1],u=[.1,.1],i=0;w(r[0],n,o),o[0]&&(a[i++]=o[0]);for(var f=1;f<t;++f){w(r[f],n,u);var s=o[1];j(s,u[0],o),o[0]&&(a[i++]=o[0]);var h=u[1],c=o[1],l=h+c,v=l-h,p=c-v;o[1]=l,p&&(a[i++]=p)}return o[1]&&(a[i++]=o[1]),0===i&&(a[i++]=0),a.length=i,a}function u(r){for(var n=r.length,t=r[r.length-1],e=n,a=n-2;a>=0;--a){var o=t,u=r[a];t=o+u;var i=t-o,f=u-i;f&&(r[--e]=t,t=f)}for(var s=0,a=e;a<n;++a){var o=r[a],u=t;t=o+u;var i=t-o,f=u-i;f&&(r[s++]=f)}return r[s++]=t,r.length=s,r}function i(r,n){return n={exports:{}},r(n,n.exports),n.exports}function f(r,n){var t=r+n,e=t-r,a=t-e,o=n-e,u=r-a,i=u+o;return i?[i,t]:[t]}function s(r,n){var t=0|r.length,e=0|n.length;if(1===t&&1===e)return f(r[0],-n[0]);var a,o,u=t+e,i=new Array(u),s=0,h=0,c=0,l=Math.abs,v=r[h],p=l(v),g=-n[c],y=l(g);p<y?(o=v,h+=1,h<t&&(v=r[h],p=l(v))):(o=g,c+=1,c<e&&(g=-n[c],y=l(g))),h<t&&p<y||c>=e?(a=v,h+=1,h<t&&(v=r[h],p=l(v))):(a=g,c+=1,c<e&&(g=-n[c],y=l(g)));for(var m,d,b,M,w,j=a+o,A=j-a,x=o-A,k=x,q=j;h<t&&c<e;)p<y?(a=v,h+=1,h<t&&(v=r[h],p=l(v))):(a=g,c+=1,c<e&&(g=-n[c],y=l(g))),o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=q+j,d=m-q,b=m-d,M=j-d,w=q-b,k=w+M,q=m;for(;h<t;)a=v,o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=q+j,d=m-q,b=m-d,M=j-d,w=q-b,k=w+M,q=m,h+=1,h<t&&(v=r[h]);for(;c<e;)a=g,o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=q+j,d=m-q,b=m-d,M=j-d,w=q-b,k=w+M,q=m,c+=1,c<e&&(g=-n[c]);return k&&(i[s++]=k),q&&(i[s++]=q),s||(i[s++]=0),i.length=s,i}function h(r,n,t,e){for(var a=0;a<2;++a){var o=r[a],u=n[a],i=Math.min(o,u),f=Math.max(o,u),s=t[a],h=e[a],c=Math.min(s,h),l=Math.max(s,h);if(l<i||f<c)return!1}return!0}function c(r,n,t,e){var a=F(r,t,e),o=F(n,t,e);if(a>0&&o>0||a<0&&o<0)return!1;var u=F(t,r,n),i=F(e,r,n);return!(u>0&&i>0||u<0&&i<0)&&(0!==a||0!==o||0!==u||0!==i||h(r,n,t,e))}function l(r,n,t,e){if(!z(r,n,t,e))return[[0],[0],[0]];var a=E([t[1]],[-e[1]]),o=E([-t[0]],[e[0]]),u=E(E(G(o,r[1]),G(o,-n[1])),E(G(a,r[0]),G(a,-n[0]))),i=E(P(-r[0],n[1]),P(r[1],n[0])),f=E(P(-t[0],e[1]),P(t[1],e[0])),s=E(E(G(f,r[0]),G(f,-n[0])),E(G(i,-t[0]),G(i,e[0]))),h=E(E(G(f,r[1]),G(f,-n[1])),E(G(i,-t[1]),G(i,e[1])));return[N(s),N(h),N(u)]}function v(r){var n=0,t=r.length;switch(t){case 1:n=r[0];break;case 2:n=r[0]+r[1];break;case 3:n=r[0]+r[1]+r[2];break;case 4:n=r[0]+r[1]+r[2]+r[3];break;default:for(var e=0;e<t;e++)n+=r[e]}return n}function p(r,n){return r[0]===n[0]&&r[1]===n[1]}function g(r,n){Array.isArray(r)?(n[0]=r[0],n[1]=r[1]):(n[0]=r.x,n[1]=r.y)}function y(r,n){for(var t={},e=r.length,a=[],o=0;o<e;o++){var u=r[o],i=r[(o+1)%e];g(u,L),g(i,Q);for(var f=0;f<e;f++)if(o!==f){var s=r[f],h=r[(f+1)%e];if(g(s,J),g(h,K),!(p(J,L)||p(J,Q)||p(K,L)||p(K,Q))){var c=D(L,Q,J,K),l=c[2];if(1!==l.length||l[0]){var v=H(c[2]);if(c[0]=H(c[0])/v,c[1]=H(c[1])/v,c.pop(),!(p(c,L)||p(c,Q)||p(c,J)||p(c,K))){var y=c+"",m=!t[y];m&&(t[y]=!0);var d=m;n&&(d=n(c,o,u,i,f,s,h,m)),d&&a.push(c)}}}}}return a}var m=n,d=+(Math.pow(2,27)+1),b=e,M=a,w=m,j=M,A=o,x=u,k=s,q=i(function(r){function n(r,n){for(var t=new Array(r.length-1),e=1;e<r.length;++e)for(var a=t[e-1]=new Array(r.length-1),o=0,u=0;o<r.length;++o)o!==n&&(a[u++]=r[e][o]);return t}function t(r){for(var n=new Array(r),t=0;t<r;++t){n[t]=new Array(r);for(var e=0;e<r;++e)n[t][e]=["m",e,"[",r-t-1,"]"].join("")}return n}function e(r){return 1&r?"-":""}function a(r){if(1===r.length)return r[0];if(2===r.length)return["sum(",r[0],",",r[1],")"].join("");var n=r.length>>1;return["sum(",a(r.slice(0,n)),",",a(r.slice(n)),")"].join("")}function o(r){if(2===r.length)return[["sum(prod(",r[0][0],",",r[1][1],"),prod(-",r[0][1],",",r[1][0],"))"].join("")];for(var t=[],u=0;u<r.length;++u)t.push(["scale(",a(o(n(r,u))),",",e(u),r[0][u],")"].join(""));return t}function u(r){for(var e=[],u=[],i=t(r),f=[],v=0;v<r;++v)0===(1&v)?e.push.apply(e,o(n(i,v))):u.push.apply(u,o(n(i,v))),f.push("m"+v);var p=a(e),g=a(u),y="orientation"+r+"Exact",m=["function ",y,"(",f.join(),"){var p=",p,",n=",g,",d=sub(p,n);return d[d.length-1];};return ",y].join(""),d=new Function("sum","prod","scale","sub",m);return d(h,s,c,l)}function i(r){var n=w[r.length];return n||(n=w[r.length]=u(r.length)),n.apply(void 0,r)}function f(){for(;w.length<=v;)w.push(u(w.length));for(var n=[],t=["slow"],e=0;e<=v;++e)n.push("a"+e),t.push("o"+e);for(var a=["function getOrientation(",n.join(),"){switch(arguments.length){case 0:case 1:return 0;"],e=2;e<=v;++e)a.push("case ",e,":return o",e,"(",n.slice(0,e).join(),");");a.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(a.join(""));var o=Function.apply(void 0,t);r.exports=o.apply(void 0,[i].concat(w));for(var e=0;e<=v;++e)r.exports[e]=w[e]}var s=m,h=b,c=A,l=k,v=5,p=1.1102230246251565e-16,g=(3+16*p)*p,y=(7+56*p)*p,d=u(3),M=u(4),w=[function(){return 0},function(){return 0},function(r,n){return n[0]-r[0]},function(r,n,t){var e,a=(r[1]-t[1])*(n[0]-t[0]),o=(r[0]-t[0])*(n[1]-t[1]),u=a-o;if(a>0){if(o<=0)return u;e=a+o}else{if(!(a<0))return u;if(o>=0)return u;e=-(a+o)}var i=g*e;return u>=i||u<=-i?u:d(r,n,t)},function(r,n,t,e){var a=r[0]-e[0],o=n[0]-e[0],u=t[0]-e[0],i=r[1]-e[1],f=n[1]-e[1],s=t[1]-e[1],h=r[2]-e[2],c=n[2]-e[2],l=t[2]-e[2],v=o*s,p=u*f,g=u*i,m=a*s,d=a*f,b=o*i,w=h*(v-p)+c*(g-m)+l*(d-b),j=(Math.abs(v)+Math.abs(p))*Math.abs(h)+(Math.abs(g)+Math.abs(m))*Math.abs(c)+(Math.abs(d)+Math.abs(b))*Math.abs(l),A=y*j;return w>A||-w>A?w:M(r,n,t,e)}];f()}),C=c,F=q[3],O=l,P=m,E=b,G=A,N=x,z=C,B=v,D=O,H=B,I=y,J=[0,0],K=[0,0],L=[0,0],Q=[0,0];r.Polygon.prototype.isects=function(){for(var n,t,e=r.Coordinate.toNumberArrays(this.getCoordinates()),a=[],o=0,u=e.length;o<u;o++)t=e[o],t.length>0&&(t=t.slice(0,t.length-1)),n=I(t),n.length>0&&a.push([o,n]);return a},r.MultiPolygon.prototype.isects=function(){for(var r,n=this.getGeometries(),t=[],e=0,a=n.length;e<a;e++)r=n[e].isects(),r.length>0&&t.push([e,r]);return t},"undefined"!=typeof console&&console.log("maptalks.isects v0.1.1, requires maptalks@^0.16.0.")});