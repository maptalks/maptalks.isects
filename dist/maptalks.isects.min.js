/*!
 * maptalks.isects v0.1.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(require("maptalks")):"function"==typeof define&&define.amd?define(["maptalks"],n):n(r.maptalks)}(this,function(r){"use strict";function n(r,n,t){var e=r*n,a=b*r,o=a-r,u=a-o,i=r-u,f=b*n,s=f-n,h=f-s,c=n-h,v=e-u*h,l=v-i*h,g=l-u*c,p=i*c-g;return t?(t[0]=p,t[1]=e,t):[p,e]}function t(r,n){var t=r+n,e=t-r,a=t-e,o=n-e,u=r-a,i=u+o;return i?[i,t]:[t]}function e(r,n){var e=0|r.length,a=0|n.length;if(1===e&&1===a)return t(r[0],n[0]);var o,u,i=e+a,f=new Array(i),s=0,h=0,c=0,v=Math.abs,l=r[h],g=v(l),p=n[c],y=v(p);g<y?(u=l,h+=1,h<e&&(l=r[h],g=v(l))):(u=p,c+=1,c<a&&(p=n[c],y=v(p))),h<e&&g<y||c>=a?(o=l,h+=1,h<e&&(l=r[h],g=v(l))):(o=p,c+=1,c<a&&(p=n[c],y=v(p)));for(var m,b,d,M,w,j=o+u,A=j-o,x=u-A,k=x,O=j;h<e&&c<a;)g<y?(o=l,h+=1,h<e&&(l=r[h],g=v(l))):(o=p,c+=1,c<a&&(p=n[c],y=v(p))),u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=O+j,b=m-O,d=m-b,M=j-b,w=O-d,k=w+M,O=m;for(;h<e;)o=l,u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=O+j,b=m-O,d=m-b,M=j-b,w=O-d,k=w+M,O=m,h+=1,h<e&&(l=r[h]);for(;c<a;)o=p,u=k,j=o+u,A=j-o,x=u-A,x&&(f[s++]=x),m=O+j,b=m-O,d=m-b,M=j-b,w=O-d,k=w+M,O=m,c+=1,c<a&&(p=n[c]);return k&&(f[s++]=k),O&&(f[s++]=O),s||(f[s++]=0),f.length=s,f}function a(r,n,t){var e=r+n,a=e-r,o=e-a,u=n-a,i=r-o;return t?(t[0]=i+u,t[1]=e,t):[i+u,e]}function o(r,n){var t=r.length;if(1===t){var e=w(r[0],n);return e[0]?e:[e[1]]}var a=new Array(2*t),o=[.1,.1],u=[.1,.1],i=0;w(r[0],n,o),o[0]&&(a[i++]=o[0]);for(var f=1;f<t;++f){w(r[f],n,u);var s=o[1];j(s,u[0],o),o[0]&&(a[i++]=o[0]);var h=u[1],c=o[1],v=h+c,l=v-h,g=c-l;o[1]=v,g&&(a[i++]=g)}return o[1]&&(a[i++]=o[1]),0===i&&(a[i++]=0),a.length=i,a}function u(r){for(var n=r.length,t=r[r.length-1],e=n,a=n-2;a>=0;--a){var o=t,u=r[a];t=o+u;var i=t-o,f=u-i;f&&(r[--e]=t,t=f)}for(var s=0,a=e;a<n;++a){var o=r[a],u=t;t=o+u;var i=t-o,f=u-i;f&&(r[s++]=f)}return r[s++]=t,r.length=s,r}function i(r,n){return n={exports:{}},r(n,n.exports),n.exports}function f(r,n){var t=r+n,e=t-r,a=t-e,o=n-e,u=r-a,i=u+o;return i?[i,t]:[t]}function s(r,n){var t=0|r.length,e=0|n.length;if(1===t&&1===e)return f(r[0],-n[0]);var a,o,u=t+e,i=new Array(u),s=0,h=0,c=0,v=Math.abs,l=r[h],g=v(l),p=-n[c],y=v(p);g<y?(o=l,h+=1,h<t&&(l=r[h],g=v(l))):(o=p,c+=1,c<e&&(p=-n[c],y=v(p))),h<t&&g<y||c>=e?(a=l,h+=1,h<t&&(l=r[h],g=v(l))):(a=p,c+=1,c<e&&(p=-n[c],y=v(p)));for(var m,b,d,M,w,j=a+o,A=j-a,x=o-A,k=x,O=j;h<t&&c<e;)g<y?(a=l,h+=1,h<t&&(l=r[h],g=v(l))):(a=p,c+=1,c<e&&(p=-n[c],y=v(p))),o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=O+j,b=m-O,d=m-b,M=j-b,w=O-d,k=w+M,O=m;for(;h<t;)a=l,o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=O+j,b=m-O,d=m-b,M=j-b,w=O-d,k=w+M,O=m,h+=1,h<t&&(l=r[h]);for(;c<e;)a=p,o=k,j=a+o,A=j-a,x=o-A,x&&(i[s++]=x),m=O+j,b=m-O,d=m-b,M=j-b,w=O-d,k=w+M,O=m,c+=1,c<e&&(p=-n[c]);return k&&(i[s++]=k),O&&(i[s++]=O),s||(i[s++]=0),i.length=s,i}function h(r,n,t,e){for(var a=0;a<2;++a){var o=r[a],u=n[a],i=Math.min(o,u),f=Math.max(o,u),s=t[a],h=e[a],c=Math.min(s,h),v=Math.max(s,h);if(v<i||f<c)return!1}return!0}function c(r,n,t,e){var a=G(r,t,e),o=G(n,t,e);if(a>0&&o>0||a<0&&o<0)return!1;var u=G(t,r,n),i=G(e,r,n);return!(u>0&&i>0||u<0&&i<0)&&(0!==a||0!==o||0!==u||0!==i||h(r,n,t,e))}function v(r,n,t,e){if(!J(r,n,t,e))return[[0],[0],[0]];var a=q([t[1]],[-e[1]]),o=q([-t[0]],[e[0]]),u=q(q(C(o,r[1]),C(o,-n[1])),q(C(a,r[0]),C(a,-n[0]))),i=q(P(-r[0],n[1]),P(r[1],n[0])),f=q(P(-t[0],e[1]),P(t[1],e[0])),s=q(q(C(f,r[0]),C(f,-n[0])),q(C(i,-t[0]),C(i,e[0]))),h=q(q(C(f,r[1]),C(f,-n[1])),q(C(i,-t[1]),C(i,e[1])));return[E(s),E(h),E(u)]}function l(r){var n=0,t=r.length;switch(t){case 1:n=r[0];break;case 2:n=r[0]+r[1];break;case 3:n=r[0]+r[1]+r[2];break;case 4:n=r[0]+r[1]+r[2]+r[3];break;default:for(var e=0;e<t;e++)n+=r[e]}return n}function g(r,n){return r[0]===n[0]&&r[1]===n[1]}function p(r,n){Array.isArray(r)?(n[0]=r[0],n[1]=r[1]):(n[0]=r.x,n[1]=r.y)}function y(r,n){for(var t={},e=r.length,a=[],o=0;o<e;o++){var u=r[o],i=r[(o+1)%e];p(u,K),p(i,L);for(var f=0;f<e;f++)if(o!==f){var s=r[f],h=r[(f+1)%e];if(p(s,H),p(h,I),!(g(H,K)||g(H,L)||g(I,K)||g(I,L))){var c=z(K,L,H,I),v=c[2];if(1!==v.length||v[0]){var l=B(c[2]);if(c[0]=B(c[0])/l,c[1]=B(c[1])/l,c.pop(),!(g(c,K)||g(c,L)||g(c,H)||g(c,I))){var y=c+"",m=!t[y];m&&(t[y]=!0);var b=m;n&&(b=n(c,o,u,i,f,s,h,m)),b&&a.push(c)}}}}}return a}var m=n,b=+(Math.pow(2,27)+1),d=e,M=a,w=m,j=M,A=o,x=u,k=s,O=i(function(r){function n(r,n){for(var t=new Array(r.length-1),e=1;e<r.length;++e)for(var a=t[e-1]=new Array(r.length-1),o=0,u=0;o<r.length;++o)o!==n&&(a[u++]=r[e][o]);return t}function t(r){for(var n=new Array(r),t=0;t<r;++t){n[t]=new Array(r);for(var e=0;e<r;++e)n[t][e]=["m",e,"[",r-t-1,"]"].join("")}return n}function e(r){return 1&r?"-":""}function a(r){if(1===r.length)return r[0];if(2===r.length)return["sum(",r[0],",",r[1],")"].join("");var n=r.length>>1;return["sum(",a(r.slice(0,n)),",",a(r.slice(n)),")"].join("")}function o(r){if(2===r.length)return[["sum(prod(",r[0][0],",",r[1][1],"),prod(-",r[0][1],",",r[1][0],"))"].join("")];for(var t=[],u=0;u<r.length;++u)t.push(["scale(",a(o(n(r,u))),",",e(u),r[0][u],")"].join(""));return t}function u(r){for(var e=[],u=[],i=t(r),f=[],l=0;l<r;++l)0===(1&l)?e.push.apply(e,o(n(i,l))):u.push.apply(u,o(n(i,l))),f.push("m"+l);var g=a(e),p=a(u),y="orientation"+r+"Exact",m=["function ",y,"(",f.join(),"){var p=",g,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",y].join(""),b=new Function("sum","prod","scale","sub",m);return b(h,s,c,v)}function i(r){var n=w[r.length];return n||(n=w[r.length]=u(r.length)),n.apply(void 0,r)}function f(){for(;w.length<=l;)w.push(u(w.length));for(var n=[],t=["slow"],e=0;e<=l;++e)n.push("a"+e),t.push("o"+e);for(var a=["function getOrientation(",n.join(),"){switch(arguments.length){case 0:case 1:return 0;"],e=2;e<=l;++e)a.push("case ",e,":return o",e,"(",n.slice(0,e).join(),");");a.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(a.join(""));var o=Function.apply(void 0,t);r.exports=o.apply(void 0,[i].concat(w));for(var e=0;e<=l;++e)r.exports[e]=w[e]}var s=m,h=d,c=A,v=k,l=5,g=1.1102230246251565e-16,p=(3+16*g)*g,y=(7+56*g)*g,b=u(3),M=u(4),w=[function(){return 0},function(){return 0},function(r,n){return n[0]-r[0]},function(r,n,t){var e,a=(r[1]-t[1])*(n[0]-t[0]),o=(r[0]-t[0])*(n[1]-t[1]),u=a-o;if(a>0){if(o<=0)return u;e=a+o}else{if(!(a<0))return u;if(o>=0)return u;e=-(a+o)}var i=p*e;return u>=i||u<=-i?u:b(r,n,t)},function(r,n,t,e){var a=r[0]-e[0],o=n[0]-e[0],u=t[0]-e[0],i=r[1]-e[1],f=n[1]-e[1],s=t[1]-e[1],h=r[2]-e[2],c=n[2]-e[2],v=t[2]-e[2],l=o*s,g=u*f,p=u*i,m=a*s,b=a*f,d=o*i,w=h*(l-g)+c*(p-m)+v*(b-d),j=(Math.abs(l)+Math.abs(g))*Math.abs(h)+(Math.abs(p)+Math.abs(m))*Math.abs(c)+(Math.abs(b)+Math.abs(d))*Math.abs(v),A=y*j;return w>A||-w>A?w:M(r,n,t,e)}];f()}),F=c,G=O[3],N=v,P=m,q=d,C=A,E=x,J=F,S=l,z=N,B=S,D=y,H=[0,0],I=[0,0],K=[0,0],L=[0,0];r.Polygon.prototype.isects=function(n){var t=this.getCoordinates();t=r.GeoJSON.toNumberArrays(t);for(var e,a,o=0,u=t.length;o<u;o++)if(a=t[o],a.length>0&&(a=a.slice(0,a.length-1)),e=D(a,n),e.length>0)return[o,e];return[]},r.MultiPolygon.prototype.isects=function(r){for(var n,t=this.getGeometries(),e=0,a=t.length;e<a;e++)if(n=t[e].isects(r),n.length>0)return[e].concat(n);return[]}});